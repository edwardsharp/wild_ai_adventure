import{h as d,j as u,k as J,n as X,l as ee,m as V,v as j,Z as oe,b as ae,d as ie,a as k,p as le,q as ce,e as ue,t as E,i as w,c as A,f as $,S as K,g as ye}from"./types-CptiQF1l.js";const de=d({challenge:u(),rp:d({id:u(),name:u()}),user:d({id:u(),name:u(),displayName:u()}),pubKeyCredParams:J(V()),timeout:X(),excludeCredentials:J(V()),authenticatorSelection:d({residentKey:u(),requireResidentKey:ee(),userVerification:u()}),attestation:u(),extensions:d({}).optional()}),pe=d({challenge:u(),timeout:X(),rpId:u(),allowCredentials:J(V()),userVerification:u()}),he=d({id:u(),rawId:u(),response:d({attestationObject:u(),clientDataJSON:u()}),type:u()}),me=d({id:u(),rawId:u(),response:d({authenticatorData:u().optional(),clientDataJSON:u(),signature:u().optional(),userHandle:u().optional()}),type:u()}),U={baseUrl:"http://localhost:8080",endpoints:{registerStart:{method:"POST",path:"/register_start/{username}",queryParams:d({invite_code:u().optional()}),requestSchema:j(),responseSchema:d({publicKey:de})},registerFinish:{method:"POST",path:"/register_finish",requestSchema:he,responseSchema:d({message:u().optional()}).optional()},loginStart:{method:"POST",path:"/login_start/{username}",requestSchema:j(),responseSchema:d({publicKey:pe})},loginFinish:{method:"POST",path:"/login_finish",requestSchema:me,responseSchema:d({message:u().optional()}).optional()},logout:{method:"POST",path:"/logout",requestSchema:j(),responseSchema:d({message:u().optional()}).optional()},health:{method:"GET",path:"/health",requestSchema:j(),responseSchema:j()},authStatus:{method:"GET",path:"/api/whoami",requestSchema:j(),responseSchema:d({authenticated:ee(),user_id:u().optional()})}}};class O extends Error{constructor(t,n,a,p){super(t),this.status=n,this.responseText=a,this.endpoint=p,this.name="ApiError"}static async fromResponse(t,n){const a=await t.text();return new O(`HTTP ${t.status}: ${a}`,t.status,a,n)}}class te{baseUrl;defaultHeaders;timeout;credentials;constructor(t={}){this.baseUrl=t.baseUrl??U.baseUrl,this.defaultHeaders=t.defaultHeaders??{},this.timeout=t.timeout??3e4,this.credentials=t.credentials??"include"}setHeader(t,n){this.defaultHeaders[t]=n}removeHeader(t){delete this.defaultHeaders[t]}getHeaders(){return{...this.defaultHeaders}}setBaseUrl(t){this.baseUrl=t}setTimeout(t){this.timeout=t}setCredentials(t){this.credentials=t}buildUrl(t,n,a){let p=t;if(n&&Object.entries(n).forEach(([C,b])=>{p=p.replace(`{${C}}`,encodeURIComponent(b))}),a){const C=new URLSearchParams;Object.entries(a).forEach(([_,v])=>{v!=null&&C.append(_,String(v))});const b=C.toString();b&&(p+=`?${b}`)}return`${this.baseUrl}${p}`}async request(t,n,a={}){const{body:p,headers:C={},responseSchema:b,requestSchema:_,endpoint:v}=a;_&&p!==void 0&&_.parse(p);const m={"Content-Type":"application/json",...this.defaultHeaders,...C},x=new AbortController,F=setTimeout(()=>x.abort(),this.timeout);try{const h=await fetch(n,{method:t,headers:m,body:p!==void 0?JSON.stringify(p):null,credentials:this.credentials,signal:x.signal});if(clearTimeout(F),!h.ok)throw await O.fromResponse(h,v);if(b instanceof oe||!b)return;let q;return h.headers.get("content-type")?.includes("application/json")?q=await h.json():q=await h.text()||void 0,b?b.parse(q):q}catch(h){throw clearTimeout(F),h instanceof O?h:h instanceof DOMException&&h.name==="AbortError"?new O(`Request timeout after ${this.timeout}ms`,408,"Request Timeout",v):new O(`Network error: ${h instanceof Error?h.message:"Unknown error"}`,0,String(h),v)}}async registerStart(t,n){const a=U.endpoints.registerStart,p=this.buildUrl(a.path,{username:t},n);return this.request(a.method,p,{requestSchema:a.requestSchema,responseSchema:a.responseSchema,endpoint:"registerStart"})}async registerFinish(t){const n=U.endpoints.registerFinish,a=this.buildUrl(n.path);return this.request(n.method,a,{body:t,requestSchema:n.requestSchema,responseSchema:n.responseSchema,endpoint:"registerFinish"})}async loginStart(t){const n=U.endpoints.loginStart,a=this.buildUrl(n.path,{username:t});return this.request(n.method,a,{requestSchema:n.requestSchema,responseSchema:n.responseSchema,endpoint:"loginStart"})}async loginFinish(t){const n=U.endpoints.loginFinish,a=this.buildUrl(n.path);return this.request(n.method,a,{body:t,requestSchema:n.requestSchema,responseSchema:n.responseSchema,endpoint:"loginFinish"})}async logout(){const t=U.endpoints.logout,n=this.buildUrl(t.path);return this.request(t.method,n,{requestSchema:t.requestSchema,responseSchema:t.responseSchema,endpoint:"logout"})}async authStatus(){const t=U.endpoints.authStatus,n=this.buildUrl(t.path);return this.request(t.method,n,{requestSchema:t.requestSchema,responseSchema:t.responseSchema,endpoint:"authStatus"})}async health(){const t=U.endpoints.health,n=this.buildUrl(t.path);return this.request(t.method,n,{requestSchema:t.requestSchema,responseSchema:t.responseSchema,endpoint:"health"})}}new te;var M=E("<div>"),ge=E("<button>Register"),be=E("<p>Ready to register with invite code (Press Enter)"),Pe=E("<button>Login"),fe=E("<p>"),ve=E('<div><input type=text placeholder=Username><input type=text placeholder="Invite or account link code (optional)">'),Se=E("<div><h2>WebAuthn Authentication"),we=E("<div><div><p>Welcome, <span></span>!</p><p>You are successfully authenticated.</p></div><button>Logout");const D=g=>{const t=atob(g.replace(/-/g,"+").replace(/_/g,"/")),n=new Uint8Array(t.length);for(let a=0;a<t.length;a++)n[a]=t.charCodeAt(a);return n},T=g=>{let t="";for(let n=0;n<g.length;n++)t+=String.fromCharCode(g[n]);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")};ae("webauthn-auth",{baseUrl:"",theme:"auto"},g=>{const[t,n]=k(""),[a,p]=k(""),[C,b]=k(!1),[_,v]=k(null),[m,x]=k(!1),[F,h]=k(""),[q,W]=k("info"),[z,B]=k("login"),H=le(()=>new te({baseUrl:g.baseUrl||"http://localhost:8080"})),R=(r,P="info")=>{h(r),W(P),setTimeout(()=>h(""),5e3)},N=r=>{const P=r instanceof O?`${r.message} (${r.status})`:r instanceof Error?r.message:"An unknown error occurred";R(P,"error");const s=document.querySelector("webauthn-auth");s&&s.dispatchEvent(new CustomEvent("webauthn-error",{detail:{error:P},bubbles:!0}))},L=async()=>{try{const r=await H().authStatus();return b(r.authenticated),v(r.user_id||null),r.authenticated}catch{return b(!1),v(null),!1}},G=async()=>{if(!t()||!a()){R("Please enter both username and invite code","error");return}x(!0);try{const r=await H().registerStart(t(),{invite_code:a()}),P={publicKey:{...r.publicKey,challenge:D(r.publicKey.challenge),attestation:r.publicKey.attestation,user:{...r.publicKey.user,id:D(r.publicKey.user.id)},authenticatorSelection:{...r.publicKey.authenticatorSelection,residentKey:r.publicKey.authenticatorSelection.residentKey,userVerification:r.publicKey.authenticatorSelection.userVerification},excludeCredentials:r.publicKey.excludeCredentials?.map(c=>({...c,id:D(c.id)})),...r.publicKey.extensions&&{extensions:r.publicKey.extensions}}},s=await navigator.credentials.create(P);if(!s)throw new Error("Failed to create credential");await H().registerFinish({id:s.id,rawId:T(new Uint8Array(s.rawId)),type:s.type,response:{attestationObject:T(new Uint8Array(s.response.attestationObject)),clientDataJSON:T(new Uint8Array(s.response.clientDataJSON))}}),R("Registration successful!","success"),await L();const i=document.querySelector("webauthn-auth");i&&i.dispatchEvent(new CustomEvent("webauthn-login",{detail:{username:t()},bubbles:!0}))}catch(r){N(r)}finally{x(!1)}},Z=async()=>{if(!t()){R("Please enter a username","error");return}x(!0);try{const r=await H().loginStart(t()),P={publicKey:{...r.publicKey,challenge:D(r.publicKey.challenge),userVerification:r.publicKey.userVerification,allowCredentials:r.publicKey.allowCredentials?.map(c=>({...c,id:D(c.id)}))}},s=await navigator.credentials.get(P);if(!s)throw new Error("Failed to get assertion");await H().loginFinish({id:s.id,rawId:T(new Uint8Array(s.rawId)),type:s.type,response:{authenticatorData:T(new Uint8Array(s.response.authenticatorData)),clientDataJSON:T(new Uint8Array(s.response.clientDataJSON)),signature:T(new Uint8Array(s.response.signature)),userHandle:s.response.userHandle?T(new Uint8Array(s.response.userHandle)):void 0}}),R("Login successful!","success"),await L();const i=document.querySelector("webauthn-auth");i&&i.dispatchEvent(new CustomEvent("webauthn-login",{detail:{username:t()},bubbles:!0}))}catch(r){N(r)}finally{x(!1)}},re=async()=>{x(!0);try{await H().logout(),b(!1),v(null),n(""),p(""),R("Logged out successfully","success");const r=document.querySelector("webauthn-auth");r&&r.dispatchEvent(new CustomEvent("webauthn-logout",{bubbles:!0}))}catch(r){N(r)}finally{x(!1)}},Y=r=>{r.key==="Enter"&&(z()==="register"&&t()&&a()?G():z()==="login"&&t()&&Z())},se=()=>{t()&&a()?B("register"):t()&&B("login")};ce(()=>{L()}),ue(()=>{se()});const ne=()=>{const r=g.theme||"auto";return r==="auto"?"webauthn-theme-auto":`webauthn-theme-${r}`};return(()=>{var r=Se(),P=r.firstChild;return r.style.setProperty("max-width","400px"),r.style.setProperty("margin","0 auto"),r.style.setProperty("padding","1.5rem"),r.style.setProperty("border","1px solid #e1e5e9"),r.style.setProperty("border-radius","8px"),r.style.setProperty("font-family",'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'),P.style.setProperty("text-align","center"),P.style.setProperty("margin-bottom","1.5rem"),P.style.setProperty("font-size","1.5rem"),P.style.setProperty("font-weight","600"),w(r,A(K,{get when(){return F()},get children(){var s=M();return s.style.setProperty("padding","0.75rem"),s.style.setProperty("border-radius","6px"),s.style.setProperty("margin-bottom","1rem"),s.style.setProperty("font-size","0.875rem"),w(s,F),$(i=>{var c=q()==="error"?"#fee2e2":q()==="success"?"#dcfce7":"#dbeafe",e=q()==="error"?"#991b1b":q()==="success"?"#166534":"#1e40af";return c!==i.e&&((i.e=c)!=null?s.style.setProperty("background",c):s.style.removeProperty("background")),e!==i.t&&((i.t=e)!=null?s.style.setProperty("color",e):s.style.removeProperty("color")),i},{e:void 0,t:void 0}),s}}),null),w(r,A(K,{get when(){return!C()},get fallback(){return(()=>{var s=we(),i=s.firstChild,c=i.firstChild,e=c.firstChild,S=e.nextSibling,o=c.nextSibling,l=i.nextSibling,f=l.firstChild;return i.style.setProperty("text-align","center"),i.style.setProperty("margin-bottom","1rem"),S.style.setProperty("font-weight","600"),w(S,_),o.style.setProperty("font-size","0.875rem"),o.style.setProperty("color","#6b7280"),o.style.setProperty("text-align","center"),o.style.setProperty("margin-top","0.5rem"),l.$$click=re,l.style.setProperty("padding","0.75rem 1.5rem"),l.style.setProperty("border","none"),l.style.setProperty("border-radius","6px"),l.style.setProperty("font-size","1rem"),l.style.setProperty("font-weight","500"),l.style.setProperty("transition","all 0.2s"),l.style.setProperty("min-height","48px"),l.style.setProperty("display","flex"),l.style.setProperty("align-items","center"),l.style.setProperty("justify-content","center"),l.style.setProperty("gap","0.5rem"),l.style.setProperty("background","#ef4444"),l.style.setProperty("color","white"),w(l,A(K,{get when(){return m()},get children(){var y=M();return y.style.setProperty("width","20px"),y.style.setProperty("height","20px"),y.style.setProperty("border","2px solid transparent"),y.style.setProperty("border-top","2px solid currentColor"),y.style.setProperty("border-radius","50%"),y.style.setProperty("animation","spin 1s linear infinite"),y}}),f),$(y=>{var I=m()?"not-allowed":"pointer",Q=m();return I!==y.e&&((y.e=I)!=null?l.style.setProperty("cursor",I):l.style.removeProperty("cursor")),Q!==y.t&&(l.disabled=y.t=Q),y},{e:void 0,t:void 0}),s})()},get children(){var s=ve(),i=s.firstChild,c=i.nextSibling;return s.style.setProperty("display","flex"),s.style.setProperty("flex-direction","column"),s.style.setProperty("gap","1rem"),i.$$keydown=Y,i.$$input=e=>n(e.currentTarget.value),i.style.setProperty("padding","0.75rem"),i.style.setProperty("border","1px solid #d1d5db"),i.style.setProperty("border-radius","6px"),i.style.setProperty("font-size","1rem"),c.$$keydown=Y,c.$$input=e=>p(e.currentTarget.value),c.style.setProperty("padding","0.75rem"),c.style.setProperty("border","1px solid #d1d5db"),c.style.setProperty("border-radius","6px"),c.style.setProperty("font-size","1rem"),w(s,A(K,{get when(){return z()==="register"},get children(){return[(()=>{var e=ge(),S=e.firstChild;return e.$$click=G,e.style.setProperty("padding","0.75rem 1.5rem"),e.style.setProperty("border","none"),e.style.setProperty("border-radius","6px"),e.style.setProperty("font-size","1rem"),e.style.setProperty("font-weight","500"),e.style.setProperty("transition","all 0.2s"),e.style.setProperty("min-height","48px"),e.style.setProperty("display","flex"),e.style.setProperty("align-items","center"),e.style.setProperty("justify-content","center"),e.style.setProperty("gap","0.5rem"),e.style.setProperty("color","white"),w(e,A(K,{get when(){return m()},get children(){var o=M();return o.style.setProperty("width","20px"),o.style.setProperty("height","20px"),o.style.setProperty("border","2px solid transparent"),o.style.setProperty("border-top","2px solid currentColor"),o.style.setProperty("border-radius","50%"),o.style.setProperty("animation","spin 1s linear infinite"),o}}),S),$(o=>{var l=m()||!t()||!a()?"not-allowed":"pointer",f=m()||!t()||!a()?"#9ca3af":"#10b981",y=m()||!t()||!a();return l!==o.e&&((o.e=l)!=null?e.style.setProperty("cursor",l):e.style.removeProperty("cursor")),f!==o.t&&((o.t=f)!=null?e.style.setProperty("background",f):e.style.removeProperty("background")),y!==o.a&&(e.disabled=o.a=y),o},{e:void 0,t:void 0,a:void 0}),e})(),(()=>{var e=be();return e.style.setProperty("font-size","0.875rem"),e.style.setProperty("color","#6b7280"),e.style.setProperty("text-align","center"),e.style.setProperty("margin-top","0.5rem"),e})()]}}),null),w(s,A(K,{get when(){return z()==="login"},get children(){return[(()=>{var e=Pe(),S=e.firstChild;return e.$$click=Z,e.style.setProperty("padding","0.75rem 1.5rem"),e.style.setProperty("border","none"),e.style.setProperty("border-radius","6px"),e.style.setProperty("font-size","1rem"),e.style.setProperty("font-weight","500"),e.style.setProperty("transition","all 0.2s"),e.style.setProperty("min-height","48px"),e.style.setProperty("display","flex"),e.style.setProperty("align-items","center"),e.style.setProperty("justify-content","center"),e.style.setProperty("gap","0.5rem"),e.style.setProperty("color","white"),w(e,A(K,{get when(){return m()},get children(){var o=M();return o.style.setProperty("width","20px"),o.style.setProperty("height","20px"),o.style.setProperty("border","2px solid transparent"),o.style.setProperty("border-top","2px solid currentColor"),o.style.setProperty("border-radius","50%"),o.style.setProperty("animation","spin 1s linear infinite"),o}}),S),$(o=>{var l=m()||!t()?"not-allowed":"pointer",f=m()||!t()?"#9ca3af":"#3b82f6",y=m()||!t();return l!==o.e&&((o.e=l)!=null?e.style.setProperty("cursor",l):e.style.removeProperty("cursor")),f!==o.t&&((o.t=f)!=null?e.style.setProperty("background",f):e.style.removeProperty("background")),y!==o.a&&(e.disabled=o.a=y),o},{e:void 0,t:void 0,a:void 0}),e})(),(()=>{var e=fe();return e.style.setProperty("font-size","0.875rem"),e.style.setProperty("color","#6b7280"),e.style.setProperty("text-align","center"),e.style.setProperty("margin-top","0.5rem"),w(e,()=>t()?"Ready to login (Press Enter, or add invite code to register)":"Enter your username to login, or username + invite code to register"),e})()]}}),null),$(e=>{var S=g.theme==="dark"?"#2a2a2a":"white",o=g.theme==="dark"?"white":"black",l=m(),f=g.theme==="dark"?"#2a2a2a":"white",y=g.theme==="dark"?"white":"black",I=m();return S!==e.e&&((e.e=S)!=null?i.style.setProperty("background",S):i.style.removeProperty("background")),o!==e.t&&((e.t=o)!=null?i.style.setProperty("color",o):i.style.removeProperty("color")),l!==e.a&&(i.disabled=e.a=l),f!==e.o&&((e.o=f)!=null?c.style.setProperty("background",f):c.style.removeProperty("background")),y!==e.i&&((e.i=y)!=null?c.style.setProperty("color",y):c.style.removeProperty("color")),I!==e.n&&(c.disabled=e.n=I),e},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),$(()=>i.value=t()),$(()=>c.value=a()),s}}),null),$(s=>{var i=`webauthn-auth ${ne()}`,c=g.theme==="dark"?"#1a1a1a":"white",e=g.theme==="dark"?"white":"black";return i!==s.e&&ye(r,s.e=i),c!==s.t&&((s.t=c)!=null?r.style.setProperty("background",c):r.style.removeProperty("background")),e!==s.a&&((s.a=e)!=null?r.style.setProperty("color",e):r.style.removeProperty("color")),s},{e:void 0,t:void 0,a:void 0}),r})()});ie(["input","keydown","click"]);
//# sourceMappingURL=webauthn-auth.js.map
